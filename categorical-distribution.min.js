/*! categorical-distribution - v6.0.0 - 2014-05-20
 * https://github.com/axelpale/categorical-distribution-js
 *
 * Copyright (c) 2014 Akseli Palen <akseli.palen@gmail.com>;
 * Licensed under the MIT license */


!function(a){"use strict";var b={},c=function(a){return"[object Array]"===Object.prototype.toString.call(a)},d=function(a){return"string"==typeof a||"number"==typeof a?[a]:c(a)?a:[]},e=function(a,b){return Math.random()*(b-a)+a},f=function(a,b,c){var d,e,f,g=[];if("number"!=typeof a&&(a=1),1>a)return g;for(g.push(1-Math.pow(Math.random(),1/a)),d=1;a>d;d+=1)e=g[g.length-1],f=1-Math.pow(Math.random(),1/(a-d)),g.push(e+(1-e)*f);for(d=0;a>d;d+=1)g[d]=b+(c-b)*g[d];return g},g=function(a){for(var b,c,d=a.length;d>0;)c=Math.floor(Math.random()*d),d-=1,b=a[d],a[d]=a[c],a[c]=b;return a},h=function(a){if(null===a||"object"!=typeof a)return a;var b=a.constructor();for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b};b.util={isArray:c,toArray:d,randomFromInterval:e,randomOrderedSetFromInterval:f,shuffle:g,clone:h},b.CategoricalDistribution=function(){var a={},b=.1;a.DEFAULT_ADAPTATION_RATE=b;var c=function(a,b,c){var d,e,f,g,h;return d=a,e=b,f=c,0===f?0:0===e?d:1===e?d/f:(g=Math.pow(e,f),h=Math.log(e),d*g*h/(g-1))},d=function(a,b){var c=Math.log(a);return-Math.log(1-b*c)/c},i=function(a,b){var c,d,e=a;return 0===e?1:1===e?b:(c=Math.pow(e,b),d=Math.log(e),(c-1)/(c*d))},j=function(a,b,c){var d,e,f,g,h,i,j,k,n;d=a.state,f=d.rate,g=Math.log(f),h=d.mass,i=c;var o,p;e=d.weights.hasOwnProperty(b)?d.weights[b]:0,0===f?(m(a,0),o=1,p=-Math.log(1-g)/g):1===f?(o=e+i,p=h+i):(j=Math.pow(f,i),k=Math.pow(f,h),o=e+(j-1)/(j*k*g),0>o?(n=-Math.log(1+e*k*g)/g,o=0,p=h+n):p=h+i),l(a,b,o),d.mass=p},k=function(a,b){var c,d,e,f,g,h,i;if(c=a.state,d=c.indices[b],e=c.weights[b],g=d===c.order.length-1,h=0===d,f=g?!0:h?!1:c.weights[c.order[d-1]]<e?!0:!1)for(;0!==d&&c.weights[c.order[d-1]]<=e;)i=c.order[d-1],c.order[d]=i,c.order[d-1]=b,c.indices[i]=d,d-=1;else for(;d!==c.order.length-1&&c.weights[c.order[d+1]]>e;)i=c.order[d+1],c.order[d]=i,c.order[d+1]=b,c.indices[i]=d,d+=1;c.indices[b]=d},l=function(a,b,c){var d=a.state;d.weights.hasOwnProperty(b)||(d.order.push(b),d.indices[b]=d.order.length-1),d.weights[b]=c,k(a,b)},m=function(a,b){var c,e,f,g,h;for(c=a.state,e=c.order.length,f=0,g=0;e>g;g+=1)h=c.order[g],c.weights[h]*=b,f+=c.weights[h];c.mass=d(c.rate,f)},n=function(a,b){var c,d,f,g,h,j=[],k=a.state;if(0===k.order.length||0>=b)return j;for(g=i(k.rate,k.mass),d=0;b>d;d+=1)for(c=e(0,g),h=0,f=0;f<k.order.length;f+=1)if(h+=k.weights[k.order[f]],h>c){j.push(k.order[f]);break}return j},o=function(a,b){var c,d,e,g,h,j,k=[],l=a.state;if(0===l.order.length||0>=b)return k;for(e=i(l.rate,l.mass),c=f(b,0,e),d=0,g=l.weights[l.order[d]],h=0;b>h;h+=1)if(j=c[h],g>j)k.push(l.order[d]);else{do d+=1,g+=l.weights[l.order[d]];while(j>=g);k.push(l.order[d])}return k},p=function(){this.name="NotAnArrayException",this.message="Parameter is required to be an array"},q=function(){this.name="InvalidDumpException",this.message="Dump cannot be loaded because of invalid syntax."},r=function(){this.name="InvalidAdaptationRateException",this.message="Adaptation rate should be a real number in closed range [0, 1]."},s=function(){this.name="InvalidDistributionException",this.message="Distribution is in unknown form."},t=function(){this.name="InvalidMassException",this.message="Mass must be a number."};a.NotAnArrayException=p,a.InvalidDumpException=q,a.InvalidAdaptationRateException=r,a.InvalidDistributionException=s,a.InvalidMassException=t;var u=function(a){this.state={weights:{},mass:0,rate:1-b,lograte:1/0,order:[],indices:{}},this.adaptationRate(a)};return a.create=function(a){return new u(a)},u.prototype.prob=function(a){var b,d,e,f,g=this.state;for("string"==typeof a?(a=[a],d=!0):d=!1,"undefined"==typeof a&&(a=g.order),b=[],e=0;e<a.length;e+=1)f=a[e],b.push(g.weights.hasOwnProperty(f)?c(g.weights[f],g.rate,g.mass):0);return d?b[0]:b},u.prototype.head=function(a){var b=this.state;return"number"!=typeof a&&(a=0),a=Math.min(a,b.order.length),a>0?b.order.slice(0,a):0===a?b.order.slice(0):[]},u.prototype.peak=function(a){var b,c,d,e=this.state;if(0===e.order.length)return[];for(c=e.weights[e.order[0]],d=c-c*a,b=1;b<e.order.length&&!(d>e.weights[e.order[b]]);b+=1);return e.order.slice(0,b)},u.prototype.subset=function(a){var b,c,e,f,g,h,i=this.state;for(e=new u(1-i.rate),f=e.state,"string"==typeof a&&(a=[a]),h=0,b=0;b<a.length;b+=1)c=a[b],i.weights.hasOwnProperty(c)&&(f.weights[c]=i.weights[c],h+=i.weights[c]);for(g=d(i.rate,h),f.mass=g,b=0;b<i.order.length;b+=1)c=i.order[b],f.weights.hasOwnProperty(c)&&(f.order.push(c),f.indices[c]=f.order.length-1);return e},u.prototype.rank=function(a){var b,c,d,e=this.state;if("string"==typeof a)return e.indices.hasOwnProperty(a)?e.indices[a]:1/0;for("undefined"==typeof a&&(a=e.order),b=[],c=0;c<a.length;c+=1)d=a[c],b.push(e.indices.hasOwnProperty(d)?e.indices[d]:1/0);return b},u.prototype.each=function(a,b){var d,e,f,g,h,i=this.state;h=i.order.slice(0);var j=h.length;for(d=0;j>d;d+=1)e=h[d],f=c(i.weights[e],i.rate,i.mass),g=i.indices[e],a.call(b,e,f,g);return this},u.prototype.map=function(a,b){var c=[];return this.each(function(d,e,f){c.push(a.call(b,d,e,f))}),c},u.prototype.sample=function(a,b){var c,d,e=this.state;return"number"!=typeof a&&(a=1),"boolean"!=typeof b&&(b=!1),b?d=o(this,a):(c=e.order.length>30,d=c?g(o(this,a)):n(this,a)),d},u.prototype.numCategories=function(){return this.state.order.length},u.prototype.dump=function(){var a,b,c=this.state,d=[];for(a=0;a<c.order.length;a+=1)b=c.order[a],d.push(b),d.push(c.weights[b]);return d.push(1-c.rate),d},u.prototype.copy=function(){var a=new u;return a.load(this.dump()),a},u.prototype.print=function(a){var b,c,d,e,f,g=this.state,h=0,i=g.order.length,j="";for("number"!=typeof a&&(a=2),a=Math.max(Math.min(a,10),0),e=this.prob(g.order),b=0;i>b;b+=1)c=g.order[b],h=Math.max(h,c.length);for(b=0;i>b;b+=1){for(c=g.order[b],d=e[b],f=c.length;h>f;f+=1)c+=" ";j+=c+" "+d.toFixed(a)+"\n"}return j},u.prototype.learn=function(a,b){var c,d;if(d=this.state,"string"==typeof a&&(a=[a]),"undefined"==typeof b&&(b=1),"number"!=typeof b)throw new t;for(c=0;c<a.length;c+=1)j(this,a[c],b);return this},u.prototype.unlearn=function(a,b){if("undefined"==typeof b&&(b=1),"number"!=typeof b)throw new t;return this.learn(a,-b)},u.prototype.adaptationRate=function(a){var b,c;if(b=this.state,"undefined"==typeof a)return 1-b.rate;if("number"!=typeof a||0>a||a>1)throw new r;return c=1-a,b.rate=c,this},u.prototype.dist=function(a){var b,e,f,g,i,j,k,l,m,n;if(b=this.state,"undefined"==typeof a){if(e=b.weights,0===b.mass)return h(e);f={};for(g in b.weights)e.hasOwnProperty(g)&&(f[g]=c(e[g],b.rate,b.mass));return f}if("object"!=typeof a)throw new s;i={},j=0,k=[];for(g in a)if(a.hasOwnProperty(g)){if(m=a[g],!(m>=0))throw new s;i[g]=m,j+=m,k.push(g)}if(isNaN(j)||1/0===j)throw new s;for(k.sort(function(a,b){return i[b]-i[a]}),l={},n=0;n<k.length;n+=1)l[k[n]]=n;return b.weights=i,b.mass=d(b.rate,j),b.order=k,b.indices=l,this},u.prototype.load=function(a){var c,e,f,g,h;if(a.length<1||a.length%2!==1)throw new q;for(g={weights:{},mass:0,rate:1-b,order:[],indices:{}},h=0,c=0;c<a.length-2;c+=2)e=a[c],f=a[c+1],g.weights[e]=f,h+=f,g.order.push(e),g.indices[e]=g.order.length-1;return g.mass=d(a[c],h),g.rate=1-a[c],this.state=g,this},a.extension=u.prototype,a}(),b.version="6.0.0",b.CategoricalDistribution.util=b.util,"object"==typeof module&&"object"==typeof module.exports?module.exports=b.CategoricalDistribution:a.CategoricalDistribution=b.CategoricalDistribution}(this);
//# sourceMappingURL=categorical-distribution.min.map