/*! categorical-distribution - v4.0.0 - 2014-04-08
 * https://github.com/axelpale/categorical-distribution-js
 *
 * Copyright (c) 2014 Akseli Palen <akseli.palen@gmail.com>;
 * Licensed under the MIT license */


!function(a){"use strict";var b={},c=function(a){return"[object Array]"===Object.prototype.toString.call(a)},d=function(a){return"string"==typeof a||"number"==typeof a?[a]:c(a)?a:[]},e=function(a,b){return Math.random()*(b-a)+a},f=function(a,b,c){var d,e,f,g=[];if("number"!=typeof a&&(a=1),1>a)return g;for(g.push(1-Math.pow(Math.random(),1/a)),d=1;a>d;d+=1)e=g[g.length-1],f=1-Math.pow(Math.random(),1/(a-d)),g.push(e+(1-e)*f);for(d=0;a>d;d+=1)g[d]=b+(c-b)*g[d];return g},g=function(a){for(var b,c,d=a.length;d>0;)c=Math.floor(Math.random()*d),d-=1,b=a[d],a[d]=a[c],a[c]=b;return a};b.util={isArray:c,toArray:d,randomFromInterval:e,randomOrderedSetFromInterval:f},b.CategoricalDistribution=function(){var a={},b=function(a,b){var c,d,e,f,g,h,i;if(c=a.state,d=c.indices[b],e=c.weights[b],g=d===c.order.length-1,h=0===d,f=g?!0:h?!1:c.weights[c.order[d-1]]<e?!0:!1)for(;0!==d&&c.weights[c.order[d-1]]<=e;)i=c.order[d-1],c.order[d]=i,c.order[d-1]=b,c.indices[i]=d,d-=1;else for(;d!==c.order.length-1&&c.weights[c.order[d+1]]>e;)i=c.order[d+1],c.order[d]=i,c.order[d+1]=b,c.indices[i]=d,d+=1;c.indices[b]=d},c=function(a,b){var c,d,e,f;for(c=a.state,d=c.order.length,e=0;d>e;e+=1)f=c.order[e],c.weights[f]*=b;c.weightsSum*=b},d=function(a,b){var c,d,f,g,h=[],i=a.state;if(0===i.order.length||0>=b)return h;for(d=0;b>d;d+=1)for(c=e(0,i.weightsSum),g=0,f=0;f<i.order.length;f+=1)if(g+=i.weights[i.order[f]],g>c){h.push(i.order[f]);break}return h},h=function(a,b){var c,d,e,g,h,i=[],j=a.state;if(0===j.order.length||0>=b)return i;for(c=f(b,0,j.weightsSum),d=0,e=j.weights[j.order[d]],g=0;b>g;g+=1)if(h=c[g],e>h)i.push(j.order[d]);else{do d+=1,e+=j.weights[j.order[d]];while(h>=e);i.push(j.order[d])}return i},i=function(){this.name="NotAnArrayException",this.message="Parameter is required to be an array"},j=function(){this.name="InvalidDumpException",this.message="Dump cannot be loaded because of invalid syntax."};a.NotAnArrayException=i,a.InvalidDumpException=j;var k=function(a){this.state={weights:{},weightsSum:0,eventWeight:1,learningRate:1,order:[],indices:{}},this.learningRate(a)};return a.create=function(a){return new k(a)},k.prototype.prob=function(a){var b,c,d,e=[],f=this.state;if("string"==typeof a)throw new i;if("undefined"==typeof a&&(a=f.order),0===f.weightsSum){for(b=0;b<a.length;b+=1)e.push(0);return e}for(b=0;b<a.length;b+=1)c=a[b],f.weights.hasOwnProperty(c)?(d=f.weights[c]/f.weightsSum,e.push(d)):e.push(0);return e},k.prototype.head=function(a){var b=this.state;return"number"!=typeof a&&(a=0),a=Math.min(a,b.order.length),a>0?b.order.slice(0,a):0===a?b.order.slice(0):[]},k.prototype.peak=function(a){var b,c,d,e=this.state;if(0===e.order.length)return[];for(c=e.weights[e.order[0]],d=c-c*a,b=1;b<e.order.length&&!(d>e.weights[e.order[b]]);b+=1);return e.order.slice(0,b)},k.prototype.subset=function(a){var b,c,d,e,f=this.state;for(d=new k(f.learningRate),e=d.state,e.eventWeight=f.eventWeight,b=0;b<a.length;b+=1)c=a[b],f.weights.hasOwnProperty(c)&&(e.weights[c]=f.weights[c],e.weightsSum+=f.weights[c]);for(b=0;b<f.order.length;b+=1)c=f.order[b],e.weights.hasOwnProperty(c)&&(e.order.push(c),e.indices[c]=e.order.length-1);return d},k.prototype.rank=function(a){var b,c,d=[],e=this.state;if("string"==typeof a)throw new i;for("undefined"==typeof a&&(a=e.order),b=0;b<a.length;b+=1)c=a[b],d.push(e.indices.hasOwnProperty(c)?e.indices[c]:1/0);return d},k.prototype.each=function(a,b){var c,d,e,f,g=this.state,h=g.order.length;for(c=0;h>c;c+=1)d=g.order[c],e=g.weights[d]/g.weightsSum,f=g.indices[d],a.call(b,d,e,f);return this},k.prototype.map=function(a,b){var c=[];return this.each(function(d,e,f){c.push(a.call(b,d,e,f))}),c},k.prototype.sample=function(a,b){var c,e,f=this.state;return"number"!=typeof a&&(a=1),"boolean"!=typeof b&&(b=!1),b?e=h(this,a):(c=f.order.length>30,e=c?g(h(this,a)):d(this,a)),e},k.prototype.size=function(){return this.state.weightsSum},k.prototype.numCategories=function(){return this.state.order.length},k.prototype.dump=function(){var a,b,c,d=this.state,e=[];for(a=0;a<d.order.length;a+=1)b=d.order[a],c=d.weights[b],e.push(b),e.push(c);return e.push(1/0===d.learningRate?null:d.learningRate),e.push(d.eventWeight),e},k.prototype.copy=function(){var a=new k;return a.load(this.dump()),a},k.prototype.print=function(a){var b,c,d,e,f,g=this.state,h=0,i=g.order.length,j="";for("number"!=typeof a&&(a=2),a=Math.max(Math.min(a,10),0),e=this.prob(g.order),b=0;i>b;b+=1)c=g.order[b],h=Math.max(h,c.length);for(b=0;i>b;b+=1){for(c=g.order[b],d=e[b],f=c.length;h>f;f+=1)c+=" ";j+=c+" "+d.toFixed(a)+"\n"}return j},k.prototype.learn=function(a){var d,e,f,g;for(f=this.state,d=0;d<a.length;d+=1)f.learningRate>Number.MAX_VALUE?(c(this,0),f.eventWeight=1):(g=f.eventWeight*f.learningRate,g>Number.MAX_VALUE?(c(this,1/f.eventWeight),f.eventWeight=f.learningRate):f.weightsSum+g>Number.MAX_VALUE?(f.eventWeight*=f.learningRate/f.weightsSum,c(this,1/f.weightsSum)):f.eventWeight*=f.learningRate),e=a[d],f.weights.hasOwnProperty(e)?f.weights[e]+=f.eventWeight:(f.weights[e]=f.eventWeight,f.order.push(e),f.indices[e]=f.order.length-1),f.weightsSum+=f.eventWeight,b(this,e);return this},k.prototype.unlearn=function(a){var c,d,e,f,g;for(c=this.state,d=0;d<a.length;d+=1)e=a[d],c.weights.hasOwnProperty(e)&&(f=Math.max(0,c.weights[e]-c.eventWeight),g=f-c.weights[e],c.weights[e]=f,c.weightsSum+=g,b(this,e),c.eventWeight/=c.learningRate);return this},k.prototype.learningRate=function(a){var b;return b=this.state,"undefined"==typeof a?b.learningRate:"number"!=typeof a?this:(a=Math.max(0,a),b.learningRate=a,this)},k.prototype.load=function(a){var b,c,d,e,f,g;if(a.length<2||a.length%2!==0)throw new j;for(e={weights:{},weightsSum:0,eventWeight:1,learningRate:1,order:[],indices:{}},b=0;b<a.length-2;b+=2)c=a[b],d=a[b+1],e.weights[c]=d,e.weightsSum+=d,e.order.push(c),e.indices[c]=e.order.length-1;return this.state=e,f=a[b],null===f?e.learningRate=1/0:this.learningRate(f),g=a[b+1],e.eventWeight=g,this},a.extension=k.prototype,a}(),b.version="4.0.0",b.CategoricalDistribution.util=b.util,"object"==typeof module&&"object"==typeof module.exports?module.exports=b.CategoricalDistribution:a.CategoricalDistribution=b.CategoricalDistribution}(this);
//# sourceMappingURL=categorical-distribution.min.map